<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<link rel="stylesheet" href="bootstrap.min.css" class="rel">

	<script src="jquery-1.11.1.min.js" type="text/javascript"></script>

	<title>Zap</title>

	<script>
		window.onload = function () {
			var arr = window.location.search.split("?")[1].split("&");
			var hostname = arr[0].split("=")[1];
			var portnum = arr[1].split("=")[1];
			var username = arr[2].split("=")[1];

			var req = $.ajax({
				url: "/join",
				method: "POST",
				data: {
					host: hostname,
					port: portnum,
					user: username
				}
			});

			req.done(function (res) {

				// Start a websocket connection
				var url = document.location.host;
				var conn = new WebSocket("ws://" + url);

				// conn.onopen = function() {

				// 	var data = {
				// 		action: "register",
				// 		data: username
				// 	};

				// 	conn.send(JSON.stringify(data));
				// }

				conn.onmessage = function (response) {
					alert(response.data);
				}

			});

			req.fail(function (err) {
				console.error(err);
			});
		}
	</script>

</head>

<body>

	<p id="host"></p>
	<p id="port"></p>

</body>

</html>