<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<link rel="stylesheet" href="bootstrap.min.css" class="rel">

	<script src="jquery-1.11.1.min.js" type="text/javascript"></script>

	<title>Zap</title>

	<script>
		window.onload = function() {
			var params = window.location.search.split("?")[1];
			var username = params.split("=")[1];

			var req = $.ajax({
				url: "/join",
				method: "POST",
				data: {
					user: username
				}
			});

			req.done(function(res) {
				
				// Start a websocket connection
				var url = document.location.host;
				var conn = new WebSocket("ws://" + url);

				conn.onopen = function() {

					var data = {
						action: "register",
						data: username
					};

					conn.send(JSON.stringify(data));
				}

				conn.onmessage = function(response) {
					alert(response.data);
				}

				setTimeout(function(){
					conn.send(JSON.stringify({
						action: "echo",
						data: "I am " + username
					}));
				}, 1000);

			});

			req.fail(function(err){
				console.error(err);
			});
		}
	</script>

</head>

<body>

	<p id="host"></p>
	<p id="port"></p>

</body>

</html>